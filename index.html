<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Tool with IndexedDB and ZIP</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        video {
            border: 2px solid #333;
            width: 100%;
            max-width: 400px;
            height: auto;
            cursor: pointer;
        }
        #photos {
            margin-top: 20px;
        }
        .photo-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            position: relative;
        }
        .photo-container img {
            width: 100px;
            height: auto;
            margin-right: 10px;
            cursor: pointer;
        }
        .photo-container input {
            flex-grow: 1;
            padding: 5px;
            font-size: 14px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .delete-btn {
            background: red;
            color: white;
            border: none;
            padding: 5px;
            cursor: pointer;
        }
        .shutter {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            opacity: 0;
            transition: opacity 0.1s ease-in-out;
            pointer-events: none;
        }
        #photo-count {
            font-size: 18px;
            font-weight: bold;
        }
        #lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
        }
        #lightbox img {
            max-width: 80%;
            max-height: 80%;
        }
    </style>
</head>
<body>
    <h1>Camera Tool with IndexedDB and ZIP</h1>
    <p id="photo-count">Photos: 0</p>
    <video id="video" autoplay playsinline></video>
    <div class="controls">
        <button id="capture">Capture</button>
        <button id="print">Print</button>
        <button id="new-session">New Session</button>
    </div>
    <div id="photos"></div>
    <div class="shutter" id="shutter"></div>
    <div id="lightbox" onclick="this.style.display='none'">
        <img id="lightbox-img" src="" alt="Enlarged Photo">
    </div>

    <script>
        const video = document.getElementById('video');
        const captureButton = document.getElementById('capture');
        const photosDiv = document.getElementById('photos');
        const photoCount = document.getElementById('photo-count');
        const shutterEffect = document.getElementById('shutter');
        let photoList = [];

        async function startCamera() {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;
        }
        startCamera();

        function updatePhotoCount() {
            photoCount.textContent = `Photos: ${photoList.length}`;
        }

        function capturePhoto() {
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
            const imageData = canvas.toDataURL('image/png');

            const photo = { image: imageData, text: '' };
            photoList.unshift(photo);
            renderPhotos();
            updatePhotoCount();

            new Audio('https://www.soundjay.com/camera/sounds/camera-shutter-click-03.mp3').play();
            shutterEffect.style.opacity = '1';
            setTimeout(() => shutterEffect.style.opacity = '0', 100);
        }

        function renderPhotos() {
            photosDiv.innerHTML = '';
            photoList.forEach((photo, index) => {
                const container = document.createElement('div');
                container.className = 'photo-container';

                const img = document.createElement('img');
                img.src = photo.image;
                img.onclick = () => {
                    document.getElementById('lightbox-img').src = photo.image;
                    document.getElementById('lightbox').style.display = 'flex';
                };
                container.appendChild(img);

                const input = document.createElement('input');
                input.type = 'text';
                input.placeholder = 'Add a description...';
                input.value = photo.text;
                input.oninput = () => photo.text = input.value;
                container.appendChild(input);

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = 'X';
                deleteBtn.onclick = () => {
                    if (confirm('Delete this photo?')) {
                        photoList.splice(index, 1);
                        renderPhotos();
                        updatePhotoCount();
                    }
                };
                container.appendChild(deleteBtn);

                photosDiv.appendChild(container);
            });
        }

        captureButton.addEventListener('click', capturePhoto);
        video.addEventListener('click', capturePhoto);

        document.getElementById('print').addEventListener('click', () => {
            const printWindow = window.open('', '', 'width=600,height=600');
            printWindow.document.write('<html><head><title>Print</title></head><body>');
            photoList.forEach(photo => {
                printWindow.document.write(`<img src="${photo.image}" style="width:100px;"><p>${photo.text}</p>`);
            });
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        });

        document.getElementById('new-session').addEventListener('click', () => {
            if (confirm('Start a new session? All photos will be deleted.')) {
                photoList = [];
                renderPhotos();
                updatePhotoCount();
            }
        });
    </script>
</body>
</html>
